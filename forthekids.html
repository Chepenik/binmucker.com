<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For The Kids</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #000;
    }

    #canvas_container {
      width: 100%;
      height: 100%;
    }

    .quoteText {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-family: Arial, sans-serif;
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      z-index: 999;
    }

    .text {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-family: Arial, sans-serif;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      z-index: 999;
    }
  </style>
</head>

<body>
  <div id="canvas_container"></div>
  <div class="quoteText"></div>
  <div class="text"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/SplitText.min.js"></script>
  <script>
    gsap.registerPlugin(SplitText);

    let webgl = {};
    let tail = {};

    (function initThree() {
      webgl.container = document.getElementById("canvas_container");
      webgl.quoteText = document.querySelector(".quoteText");
      webgl.text = document.querySelector(".text");

      webgl.scene = new THREE.Scene();
      webgl.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 10000);
      webgl.camera.position.z = 180;
      webgl.renderer = new THREE.WebGLRenderer({
        alpha: true
      });
      webgl.renderer.setSize(webgl.container.clientWidth, webgl.container.clientHeight);
      webgl.renderer.setPixelRatio(window.devicePixelRatio);
      webgl.container.appendChild(webgl.renderer.domElement);

      webgl.loader = new THREE.TextureLoader();
      webgl.clock = new THREE.Clock(true);
      webgl.loader.crossOrigin = '';

      webgl.textureIndex = 1;
      webgl.threshold = 30;
      webgl.lastClick = 0;
      tail.on = false;

      webgl.texture = webgl.loader.load(document.getElementById("first").src, setup);

      Promise.all([
        webgl.texture,
        webgl.loader.load('https://i.ibb.co/WnbfKGk/2.jpg'),
        webgl.loader.load('https://i.ibb.co/4RWFQtT/3.jpg'),
        loadAsync("https://i.imgur.com/FyHLAY8.mp4"),
        webgl.loader.load('https://i.ibb.co/RjjfRYn/4.jpg'),
        webgl.loader.load('https://i.ibb.co/wzXGCjc/5.jpg'),
        webgl.loader.load('https://i.ibb.co/CvFkkt5/6.jpg'),
        webgl.loader.load('https://i.ibb.co/RHXmW7L/7.jpg'),
        webgl.loader.load('https://i.ibb.co/JmPZX9p/8.jpg'),
        webgl.loader.load('https://i.ibb.co/VBkjyYD/9.jpg')
      ]).then(() => {
        webgl.texture.needsUpdate = true;
        webgl.loader.load('https://i.ibb.co/7S0Szmp/10.jpg', texture => {
          webgl.texture.callback = texture.image;
          webgl.texture.flipY = false;
          webgl.texture.needsUpdate = true;
          webgl.textureIndex = 0;
          webgl.threshold = 0;
        });

        document.getElementById("clickme").addEventListener("click", changeTexture);
      });
    })();

    function loadAsync(url) {
      return new Promise((resolve) => {
        const video = document.createElement('video');
        video.src = url;
        video.preload = 'auto';
        video.loop = true;
        video.muted = true;
        video.addEventListener('canplay', () => {
          const texture = new THREE.VideoTexture(video);
          resolve(texture);
        });
      });
    }

    function changeTexture() {
      if (tail.on) return;
      let now = new Date().getTime() / 1000;
      if (now - webgl.lastClick > 0.5) {
        webgl.lastClick = now;

        let index = webgl.textureIndex;
        let quote = webgl.quoteText;
        let splitQuote = new SplitText(quote, {
          type: "chars"
        });
        let chars = splitQuote.chars;
        let text = webgl.text;
        let splitText = new SplitText(text, {
          type: "chars"
        });
        let textChars = splitText.chars;
        let textureOptions = webgl.textureOptions;
        let threshold = webgl.threshold;

        gsap.to(chars, {
          duration: 1.5,
          opacity: 0,
          y: -100,
          stagger: {
            amount: 0.2,
            from: "end",
            ease: "back.in(1)"
          },
          onComplete: () => {
            quote.innerHTML = textureOptions[index].quote;
            text.innerHTML = textureOptions[index].quote;

            gsap.fromTo(chars, {
              opacity: 0,
              y: 100
            }, {
              duration: 1.5,
              opacity: 1,
              y: 0,
              stagger: {
                amount: 0.2,
                ease: "back.out(1)"
              }
            });
          }
        });

        gsap.to(textChars, {
          duration: 1.5,
          opacity: 0,
          y: -100,
          stagger: {
            amount: 0.2,
            from: "end",
            ease: "back.in(1)"
          },
          onComplete: () => {
            gsap.fromTo(textChars, {
              opacity: 0,
              y: 100
            }, {
              duration: 1.5,
              opacity: 1,
              y: 0,
              stagger: {
                amount: 0.2,
                ease: "back.out(1)"
              }
            });
          }
        });

        gsap.to(tail, {
          duration: 1.5,
          threshold: textureOptions[index].threshold,
          onComplete: () => {
            tail.on = false;
          }
        });

        if (index < textureOptions.length - 1) {
          webgl.textureIndex++;
        } else {
          webgl.textureIndex = 0;
        }
      }
    }

    function setup(texture) {
      webgl.textureOptions = [
        {
          texture: webgl.texture,
          quote: "Texture 1",
          threshold: 50
        },
        {
          texture: texture,
          quote: "Texture 2",
          threshold: 70
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/4RWFQtT/3.jpg'),
          quote: "Texture 3",
          threshold: 30
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/RjjfRYn/4.jpg'),
          quote: "Texture 4",
          threshold: 80
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/wzXGCjc/5.jpg'),
          quote: "Texture 5",
          threshold: 90
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/CvFkkt5/6.jpg'),
          quote: "Texture 6",
          threshold: 60
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/RHXmW7L/7.jpg'),
          quote: "Texture 7",
          threshold: 20
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/JmPZX9p/8.jpg'),
          quote: "Texture 8",
          threshold: 40
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/VBkjyYD/9.jpg'),
          quote: "Texture 9",
          threshold: 10
        },
        {
          texture: webgl.loader.load('https://i.ibb.co/7S0Szmp/10.jpg'),
          quote: "Texture 10",
          threshold: 5
        }
      ];

      let geometry = new THREE.PlaneBufferGeometry(256, 256, 10, 10);
      let material = new THREE.MeshBasicMaterial({
        map: texture,
        transparent: true
      });
      let mesh = new THREE.Mesh(geometry, material);
      webgl.scene.add(mesh);

      let videoMaterial = new THREE.MeshBasicMaterial({
        map: webgl.textureOptions[3].texture,
        side: THREE.DoubleSide
      });

      let videoGeometry = new THREE.PlaneGeometry(400, 200);
      let videoMesh = new THREE.Mesh(videoGeometry, videoMaterial);
      videoMesh.position.set(0, -60, -50);
      webgl.scene.add(videoMesh);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);

      let delta = webgl.clock.getDelta();
      webgl.renderer.render(webgl.scene, webgl.camera);
    }
  </script>
</body>

</html>
